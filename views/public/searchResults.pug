extends ../layouts/public

block content
  section.page-header.py-4
    .container
      h2.h3.mb-1 Resultados de búsqueda
      if search
        p.text-muted.mb-0 Buscando: "#{search}"
      else
        p.text-muted.mb-0 Ingresa un término para buscar obras, artistas o exposiciones.


  .container-xxl.my-4
    // Tabs
    - const artworksCount = typeof totalArtworks !== 'undefined' ? totalArtworks : (artworks ? artworks.length : 0);
    - const artistsCount = artists ? artists.length : 0;
    - const exhibitionsCount = exhibitions ? exhibitions.length : 0;
    - const totalCount = artworksCount + artistsCount + exhibitionsCount;
    ul.nav.nav-tabs.mb-4#searchTabs(role="tablist")
      li.nav-item.flex-fill.text-center
        a.nav-link.active.w-100(href="#tab-obras", data-bs-toggle="tab", data-tab="obras", role="tab") Obras (#{artworksCount})
      li.nav-item.flex-fill.text-center
        a.nav-link.w-100(href="#tab-artistas", data-bs-toggle="tab", data-tab="artistas", role="tab") Artistas (#{artistsCount})
      li.nav-item.flex-fill.text-center
        a.nav-link.w-100(href="#tab-exposiciones", data-bs-toggle="tab", data-tab="exposiciones", role="tab") Exposiciones (#{exhibitionsCount})

    // Tab Contents
    .tab-content

      // OBRAS TAB
      .tab-pane.active#tab-obras
        // Filtros solo visibles en el tab Obras
        // Set variables before including the filter fragment
        - var q = typeof q !== 'undefined' ? q : {};
        - var materials = typeof materials !== 'undefined' ? materials : [];
        - var priceBounds = typeof priceBounds !== 'undefined' ? priceBounds : {};
        - var appliedPrice = typeof appliedPrice !== 'undefined' ? appliedPrice : {};
        - var actionUrl = '/search';
        .artwork-filters.mt-3.mb-3(id="artwork-filters")
          include _artworkFilters.pug
        .container-xxl
          if artworks && artworks.length
            ul.grid.effect-2#grid
              each a in artworks
                li
                  a(href=`/artworks/${a.slug || a._id}`)
                    img(src=a.imageUrl)
                  .mt-2.text-muted
                    span= a.title
                    if a.artist
                      |  · 
                      span.text-secondary= a.artist.name
                    if typeof a.price_cents === 'number'
                      |  · 
                      span= '$' + (a.price_cents/100).toLocaleString('en-US', {minimumFractionDigits:2})
                    else if typeof a.price === 'number'
                      |  · 
                      span= a.price.toLocaleString('en-US', { style: 'currency', currency: 'USD' })
            nav.mt-4.mb-4.d-flex.justify-content-center#pager-obras(aria-label="Paginación obras" data-tab="obras")
              ul.pagination-ox.pagination-lg
                li.page-item.active
                  a.page-link.tabindex-0(href=`?q=${search}&tab=obras&page=1` data-page="1" aria-current="page") 1
          else
            h3.h5.mt-4.text-muted No se encontraron obras.

      // ARTISTAS TAB
      .tab-pane#tab-artistas
        if artistsCount
          h3.h5.mb-3 Artistas encontrados
          ul.list-group.mb-4#list-artistas
            each artist, i in artists.slice(0,12)
              li.list-group-item
                a(href=`/artistas/${artist._id}`)
                  | #{artist.name}
          if artistsCount > 12
            .d-flex.justify-content-end.mb-3
              button.btn.btn-outline-primary.btn-sm(data-more="artistas") Ver más
        else
          h3.h5.mt-4.text-muted No se encontraron artistas.

      // EXPOSICIONES TAB
      .tab-pane#tab-exposiciones
        if exhibitionsCount
          h3.h5.mb-3 Exposiciones encontradas
          ul.list-group#list-exposiciones
            each expo, i in exhibitions.slice(0,12)
              li.list-group-item
                a(href=`/exposiciones/${expo._id}`)
                  | #{expo.title}
          if exhibitionsCount > 12
            .d-flex.justify-content-end.mb-3
              button.btn.btn-outline-primary.btn-sm(data-more="exposiciones") Ver más
        else
          h3.h5.mt-4.text-muted No se encontraron exposiciones.
