extends ../layouts/public

block content
  .container.forgot-password-container
    .row.justify-content-center
      .col-md-6.col-lg-5
        .d-flex.align-items-center.py-4(style="min-height:100vh;")
          main.form-signin.w-100.m-auto.font-title
            form#forgotForm(method="POST", action="/api/v1/auth/password/forgot")
              // Logo actualizado para coincidir con el del navbar
              a.navbar-brand.d-flex.align-items-center.navbar-logo-link.mb-4(href="/")
                img.logo-navbar(src="/Logos/GOX_LOGO_06.png" alt="Galería del Ox")
                h1.ms-1.text-uppercase.fw-bold.navbar-title Galería del Ox
              h1.h3.mb-3.fw-normal.mb-3 Recuperar contraseña

              if error
                .alert.alert-danger.mb-3= error
              if success
                .alert.alert-success.mb-3= success

              .form-floating.mb-3
                input.form-control(type="email", id="email", name="email", placeholder="name@example.com", required)
                label(for="email") Correo electrónico

              button.btn.btn-primary.w-100.py-2.mt-1.mb-4(type="submit") Enviar enlace de restablecimiento

              .d-flex.justify-content-center.mb-3
                a.btn.btn-outline-primary.ox-back-btn(href="/login")
                  i.fas.fa-arrow-left.me-2
                  | Volver

              p.mt-5.mb-3.text-body-secondary.text-center © 2025 Galería del Ox

  // Script para manejo asíncrono (opcional; mejora UX)
  script.
    (function(){
      var form = document.getElementById('forgotForm');
      if(!form) return;
      form.addEventListener('submit', function(e){
        e.preventDefault();
        var email = form.email && form.email.value;
        var existingAlert = form.querySelector('.alert');
        if(existingAlert){ existingAlert.parentNode.removeChild(existingAlert); }
        var info = document.createElement('div');
        info.className = 'alert alert-info mb-3';
        info.textContent = 'Enviando…';
        form.insertBefore(info, form.querySelector('.form-floating'));

        fetch(form.action, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email: email }) })
        .then(function(res){ return res.json().catch(function(){return {};}).then(function(json){return { ok: res.ok, json: json };}); })
        .then(function(result){
          info.className = 'alert ' + (result.ok ? 'alert-success' : 'alert-warning') + ' mb-3';
          info.textContent = (result.json && result.json.message) || 'Si el email existe, te enviaremos un enlace para restablecer tu contraseña.';
        })
        .catch(function(){
          info.className = 'alert alert-danger mb-3';
          info.textContent = 'No se pudo procesar la solicitud. Intenta de nuevo.';
        });
      });
    })();


