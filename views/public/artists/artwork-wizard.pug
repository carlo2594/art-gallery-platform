extends /layouts/public

block headExtra
  style.
    .main-navbar,
    #navUserMobile,
    #navMainOverlay,
    #navUserOverlay,
    footer,
    .footer { display: none !important; }
  link(rel='stylesheet', href='/css/artist-wizard.css')

block content
  main.main-content.artist-detail-page
    section.artist-artwork-wizard.py-5
      .container
        .row.mb-4
          .col-12.col-lg-8.mx-auto.d-flex.justify-content-between.align-items-start
            .artist-wizard-header-text
              h1.display-4.fw-bold.mb-2(style='color: var(--ox-blue);') Nueva obra
              if artist && artist.name
                p.lead.mb-0.text-muted= `Crear una nueva obra para ${artist.name}`
              else
                p.lead.mb-0.text-muted Crea una nueva obra
            a.btn-close.btn-close-dark(
              href='/artists/panel'
              aria-label='Volver al panel de artista'
            )
        .row
          .col-12.col-lg-8.mx-auto
            // Texto y barra de progreso del flujo
            p#artistWizardStepTitle.text-uppercase.small.fw-semibold.mb-1(style='color: var(--ox-blue);') Paso 1 de 4 – Información básica
            .progress.mb-4
              .progress-bar.bg-primary#artistWizardProgressBar(
                role='progressbar'
                style='width: 25%;'
                aria-valuenow='1'
                aria-valuemin='1'
                aria-valuemax='4'
              )
            // Pasos del flujo (iconos + texto)
            .artist-wizard-steps.d-flex.justify-content-between.mb-4
              .artist-wizard-step(data-step='1')
                i.fas.fa-info-circle.artist-wizard-step-icon
                span.artist-wizard-step-label Información básica
              .artist-wizard-step(data-step='2')
                i.fas.fa-ruler-combined.artist-wizard-step-icon
                span.artist-wizard-step-label Dimensiones
              .artist-wizard-step(data-step='3')
                i.fas.fa-palette.artist-wizard-step-icon
                span.artist-wizard-step-label Técnica y precio
              .artist-wizard-step(data-step='4')
                i.fas.fa-image.artist-wizard-step-icon
                span.artist-wizard-step-label Imagen

            #artistArtworkWizardAlerts.mb-3

            form#artistArtworkWizardForm(enctype='multipart/form-data')
              input(type='hidden', name='artworkId', id='artistArtworkId')

              // Paso 1: título y descripción
              .artist-wizard-pane(data-step='1')
                h2.h4.mb-3(style='color: var(--ox-blue);') Información básica
                .mb-3
                  label.form-label(for='wizardTitle') Título de la obra *
                  .d-flex.align-items-center.justify-content-between.mb-1
                    small.text-muted.mb-0#wizardTitleCounter 0/50
                  input#wizardTitle.form-control(
                    type='text',
                    name='title',
                    required,
                    placeholder='Título de la obra',
                    maxlength='50'
                  )
                .mb-3
                  label.form-label(for='wizardDescription') Descripción
                  .d-flex.align-items-center.justify-content-between.mb-1
                    small.text-muted.mb-0#wizardDescriptionCounter 0/200
                  textarea#wizardDescription.form-control(
                    name='description',
                    rows='4',
                    placeholder='Describe brevemente la obra (opcional)',
                    maxlength='200'
                  )

                .d-flex.justify-content-between.mt-4
                  a.btn.btn-outline-secondary(href='/artists/panel') Volver al panel
                  button.btn.btn-primary(type='button', data-wizard-next='2') Siguiente

              // Paso 2: dimensiones y fecha
              .artist-wizard-pane.d-none(data-step='2')
                h2.h4.mb-3(style='color: var(--ox-blue);') Dimensiones y fecha
                .row.g-3
                  .col-md-6
                    label.form-label(for='wizardWidth') Ancho (cm) *
                    input#wizardWidth.form-control(type='number', name='width_cm', min='1', step='1', placeholder='Ej. 80')
                  .col-md-6
                    label.form-label(for='wizardHeight') Alto (cm) *
                    input#wizardHeight.form-control(type='number', name='height_cm', min='1', step='1', placeholder='Ej. 60')
                .mt-3
                  label.form-label(for='wizardCompletedAt') Fecha de la obra
                  input#wizardCompletedAt.form-control(type='date', name='completedAt')

                .d-flex.justify-content-between.mt-4
                  button.btn.btn-outline-secondary(type='button', data-wizard-prev='1') Anterior
                  button.btn.btn-primary(type='button', data-wizard-next='3') Siguiente

              // Paso 3: técnica y precio
              .artist-wizard-pane.d-none(data-step='3')
                h2.h4.mb-3(style='color: var(--ox-blue);') Técnica y precio
                .row.g-3
                  .col-12
                    label.form-label(for='wizardTechnique') Técnica
                    input#wizardTechnique.form-control(type='text', name='technique', placeholder='Óleo, acrílico, etc.')
                .mt-3
                  label.form-label(for='wizardAmount') Precio (USD) *
                  input#wizardAmount.form-control(type='number', name='amount', min='0', step='0.01', placeholder='0.00')
                  small.text-muted.mt-1 El precio se guarda en dólares estadounidenses.

                .d-flex.justify-content-between.mt-4
                  button.btn.btn-outline-secondary(type='button', data-wizard-prev='2') Anterior
                  button.btn.btn-primary(type='button', data-wizard-next='4') Siguiente

              // Paso 4: imagen
              .artist-wizard-pane.d-none(data-step='4')
                .mb-3
                  label.form-label(for='wizardImage') Imagen principal *
                  .artist-image-dropzone#artistImageDropzone
                    img#wizardImagePreview.artist-image-preview.img-thumbnail(
                      src=''
                      alt='Vista previa de la obra'
                      hidden
                    )
                    .artist-image-dropzone-instructions
                      i.fas.fa-cloud-upload-alt.me-2
                      span Arrastra la imagen aquí o 
                      button#wizardImageTrigger.btn.btn-link.p-0(type='button') búscala en tu dispositivo
                    input#wizardImage.form-control(
                      type='file'
                      name='image'
                      accept='image/*'
                      hidden
                    )

                .d-flex.justify-content-between.mt-4
                  button.btn.btn-outline-secondary(type='button', data-wizard-prev='3') Anterior
                  .d-flex.gap-2
                    button#wizardSaveDraft.btn.btn-outline-secondary(type='button') Guardar borrador
                    button#wizardSubmit.btn.btn-success(type='button', disabled) Enviar obra para revisión

    // Modal de confirmación de envío
    #artistSubmitConfirmModal.modal.fade(tabindex='-1' aria-labelledby='artistSubmitConfirmLabel' aria-hidden='true')
      .modal-dialog.modal-dialog-centered
        .modal-content
          .modal-header
            h5#artistSubmitConfirmLabel.modal-title Confirmar envío
            button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Cerrar')
          .modal-body
            p.mb-2 ¿Quieres enviar esta obra para revisión?
            p.text-muted.small.mb-0 Una vez enviada, no podrás editar la obra ni la información que subiste. Si necesitas hacer cambios después, tendrás que eliminar esta solicitud y crear una nueva.
          .modal-footer.d-flex.flex-column.flex-md-row.gap-2.justify-content-between
            button#artistSubmitKeepEditingBtn.btn.btn-outline-secondary(type='button', data-bs-dismiss='modal') Seguir editando
            button#artistSubmitSaveDraftBtn.btn.btn-outline-secondary(type='button') Guardar en borrador
            button#artistSubmitConfirmBtn.btn.btn-success(type='button') Enviar obra

block scriptsExtra
  script(src='/js/artist-artwork-wizard.js')
  script(src='/js/artist-artwork-confirm-modal.js')
