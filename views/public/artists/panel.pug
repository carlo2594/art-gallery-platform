extends /layouts/public

block headExtra
  if isMyPanel
    link(rel='stylesheet', href='https://unpkg.com/cropperjs@1.6.1/dist/cropper.min.css')


block content
  main.main-content.artist-detail-page
    // Hero Section
    section.artist-profile-hero.artist-hero-section.position-relative.artist-hero-fullscreen
      .hero-background.artist-hero-bg.position-absolute.w-100.h-100
        - const heroCover = artist.coverImage
        if heroCover
          img.hero-bg-image.artist-bg-image.w-100.h-100.artist-image-cover(
            src=heroCover,
            alt=artist.name
          )
        else
          .hero-bg-placeholder.artist-bg-placeholder.w-100.h-100.artist-gradient-bg
      .hero-overlay.artist-hero-overlay.position-absolute.w-100.h-100.exhibition-hero-overlay
      .hero-content.artist-hero-content.position-absolute.bottom-0.start-0.w-100.artist-hero-z-index
        .container
          .row
            .col-12.col-lg-8
              .artist-hero-info.artist-info-desktop.text-white.pb-5.artist-hero-card.p-4.p-lg-5
                h1.hero-title.artist-name-desktop.display-2.fw-bold.mb-3.artist-title-font.artist-text-shadow= artist.name
                if stats && stats.techniques && stats.techniques.length
                  .artist-techniques-inline.d-flex.flex-wrap.align-items-center.gap-3.mb-4
                    span.artist-techniques-heading.text-white-75.text-uppercase.small.fw-semibold Techniques
                    .artist-techniques-tags.d-flex.flex-wrap.align-items-center.gap-2
                      each technique in stats.techniques.slice(0, 10)
                        - var normalizedTechnique = technique ? technique.toString().trim() : ''
                        - normalizedTechnique = normalizedTechnique ? normalizedTechnique.charAt(0).toUpperCase() + normalizedTechnique.slice(1).toLowerCase() : ''
                        if normalizedTechnique
                          span.small.text-warning.fw-bold.artist-technique-tag= normalizedTechnique
                    if stats.techniques.length > 10
                      span.small.text-white-50.artist-techniques-more +#{stats.techniques.length - 10} but
                if artist.createdAt
                  h2.hero-subtitle.artist-member-since.h4.mb-4.text-white-50.artist-subtitle-font.artist-text-shadow-light= `Member since ${new Date(artist.createdAt).getFullYear()}`
                if artist.bio
                  p.hero-bio.artist-bio-desktop.lead.mb-4.text-white-75.artist-bio-style= artist.bio
                .hero-meta.artist-meta-desktop.d-flex.flex-wrap.gap-4.mb-4
                  if artist.location
                    .meta-item.artist-location-item.d-flex.align-items-center
                      i.fas.fa-map-marker-alt.me-2.text-warning
                      span.text-white-75= artist.location
                  if artist.website
                    .meta-item.artist-website-item
                      a.text-warning.text-decoration-none(href=artist.website, target="_blank", rel="noopener")
                        i.fas.fa-globe.me-2
                        span Website
                  if artist.social && artist.social.instagram
                    .meta-item.artist-social-instagram
                      a.text-warning.text-decoration-none(href=`https://instagram.com/${artist.social.instagram}`, target="_blank", rel="noopener")
                        i.fab.fa-instagram.me-2
                        span Instagram
                  if artist.social && artist.social.x
                    .meta-item.artist-social-x
                      a.text-warning.text-decoration-none(href=`https://x.com/${artist.social.x}`, target="_blank", rel="noopener")
                        i.fab.fa-x.me-2
                  if artist.social && artist.social.facebook
                    .meta-item.artist-social-facebook
                      a.text-warning.text-decoration-none(href=`https://facebook.com/${artist.social.facebook}`, target="_blank", rel="noopener")
                        i.fab.fa-facebook.me-2
                        span Facebook
                if !isMyPanel
                  .hero-actions.artist-actions-desktop.d-flex.gap-3
                    // BotÃ³n Seguir/Siguiendo
                    - var following = typeof isFollowing !== 'undefined' ? isFollowing : false;
                    button.btn.btn-outline-light.btn-lg.px-4.artist-follow-btn.artist-action-btn(type="button" data-artist-id=artist._id aria-pressed=following ? 'true' : 'false' class= following ? 'active' : '')
                      i.fas.fa-heart.me-2
                      | #{following ? 'Following' : 'Follow'}
                    button.btn.btn-outline-light.btn-lg.px-4.artist-share-btn.artist-action-btn
                      i.fas.fa-share.me-2
                      | Share
                if isMyPanel
                  .hero-actions.artist-actions-desktop.mt-3.d-flex.flex-wrap.gap-2
                    // Botón controlado por JS: abre modal de crear o el modal de límite
                    //- Botón \"Agregar obra\" eliminado
                    button.btn.btn-outline-light.btn-sm(data-bs-toggle='modal', data-bs-target='#artistCoverModal')
                      i.fas.fa-image.me-2
                      | Edit cover
                    a.btn.btn-outline-light.btn-sm(href='/edit-profile')
                      i.fas.fa-user-edit.me-2
                      | Edit profile

    // Obras del artista
    if artworks && artworks.length > 0
      section.artist-artworks.artist-artworks-section.py-5.artist-artworks-bg
        .container
          .row.mb-5
            .col-12
              .d-flex.justify-content-between.align-items-center.mb-4
                h2.section-title.artist-artworks-title.display-5.fw-bold.mb-0.artist-section-title= `Artworks by ${artist.name}`
                if isMyPanel
                  a#artistAddArtworkBtn.btn.btn-primary.btn-lg.px-4.py-2.artist-add-artwork-btn(
                    href='/artists/panel/artworks/new'
                    aria-label='Add works'
                    data-max-artworks='10'
                  )
                    i.fas.fa-plus.me-2.artist-add-artwork-icon
                    | Add works
              - var displayText = artworks.length === totalArtworks ? `${totalArtworks} work${totalArtworks === 1 ? '' : 's'}` : `Showing ${artworks.length} of ${totalArtworks} works`
              p.lead.text-muted.artist-artworks-subtitle= `${displayText} by this talented artist`
        if totalArtworks > 1
          section.filters-toolbar.artist-filters-section.py-2
            .container-xxl.d-flex.align-items-center.flex-wrap.gap-2.artist-container-padding
              - var q = typeof q !== 'undefined' ? q : {};
              - var techniques = typeof techniques !== 'undefined' ? techniques : [];
              - var priceBounds = typeof priceBounds !== 'undefined' ? priceBounds : {};
              - var appliedPrice = typeof appliedPrice !== 'undefined' ? appliedPrice : {};
              - var actionUrl = `/artists/panel`;
              include /public/artworks/_artworkFilters.pug
        .container-xxl.artworks-flex.artist-artworks-grid.artist-container-padding
          if artworks && artworks.length
            .artworks-grid-paginate.artist-artworks-paginate
              - var backTo = typeof currentPath !== 'undefined' ? currentPath : ''
              include /public/artworks/_artworkGrid.pug
              include /public/artworks/_artworkPagination.pug
          else
            h3.h5.mt-4.text-muted.artist-no-filtered-artworks No works were found with these filters.
    else
      section.no-artworks.artist-no-artworks-section.py-5.text-center
        .container
          .d-flex.justify-content-between.align-items-center.mb-4
            h2.section-title.artist-no-artworks-title.display-4.fw-bold.mb-0.artist-section-title= `Artworks by ${artist.name}`
            if isMyPanel
              a#artistAddArtworkBtn.btn.btn-primary.btn-lg.px-4.py-2.artist-add-artwork-btn(
                href='/artists/panel/artworks/new'
                aria-label='Add works'
                data-max-artworks='10'
              )
                i.fas.fa-plus.me-2.artist-add-artwork-icon
                | Add works
          if stats.totalArtworks > 1
            section.filters-toolbar.artist-no-artworks-filters.py-2.mb-4
              .container-xxl.d-flex.align-items-center.flex-wrap.gap-2.artist-container-padding
                - var q = typeof q !== 'undefined' ? q : {};
                - var techniques = typeof techniques !== 'undefined' ? techniques : [];
                - var priceBounds = typeof priceBounds !== 'undefined' ? priceBounds : {};
                - var appliedPrice = typeof appliedPrice !== 'undefined' ? appliedPrice : {};
                - var actionUrl = `/artists/panel`;
                include /public/artworks/_artworkFilters.pug
          .row.justify-content-center.mt-3
            .col-lg-6
              i.fas.fa-palette.fa-4x.text-muted.mb-4.artist-no-artworks-icon
              if stats.totalArtworks > 1
                h3.h4.mb-3.text-muted.artist-filtered-message No works were found with these filters
                p.text-muted.artist-filter-help Try adjusting the filters or
                  |  
                  a(href=actionUrl) clean all filters
                  |  to see all the works of #{artist.name}
              else if stats.totalArtworks === 1
                h3.h4.mb-3.text-muted.artist-single-work= `${artist.name} has a published work`
                p.text-muted.artist-single-work-message This is the only work available by this talented artist. Come back soon to see more creations!
              else
                h3.h4.mb-3.text-muted.artist-no-published-works= `${artist.name} does not have published works yet`
                 p.text-muted.artist-portfolio-message This artist is preparing his portfolio. Come back soon to see their creations!

    if isMyPanel
      // Gestión de obras del artista (borradores y enviadas)
      section.artist-manage-section.py-5
        .container
          .row
            .col-12
              h2.h4.mb-3 Management of my works
              p.text-muted.small Manage your draft works and send them for review.
              #artistPanelAlerts
          .row.g-4
            .col-12.col-lg-4
              .card.shadow-sm
                .card-header.bg-light.d-flex.align-items-center.justify-content-between
                  span.fw-semibold Erasers
                    span#countDrafts.badge.bg-secondary.ms-2 0
                  button.btn.btn-sm.btn-outline-primary#reloadDrafts(type='button')
                    i.fas.fa-rotate-right.me-1
                    | Update
                .card-body
                  ul.list-group.list-group-flush#artistDraftsList
                    li.list-group-item.text-muted.small There are no drafts.
            .col-12.col-lg-4
              .card.shadow-sm
                .card-header.bg-light.d-flex.align-items-center.justify-content-between
                  span.fw-semibold Sent
                    span#countSubmitted.badge.bg-secondary.ms-2 0
                  button.btn.btn-sm.btn-outline-primary#reloadSubmitted(type='button')
                    i.fas.fa-rotate-right.me-1
                    | Update
                .card-body
                  ul.list-group.list-group-flush#artistSubmittedList
                    li.list-group-item.text-muted.small There are no works sent.
            //- Columna de rechazadas: visible solo si hay elementos (la muestra JS)
            .col-12.col-lg-4.artist-rejected-column#rejectedColumn
              .card.shadow-sm
                .card-header.bg-light.d-flex.align-items-center.justify-content-between
                  span.fw-semibold Rejected
                    span#countRejected.badge.bg-secondary.ms-2 0
                  button.btn.btn-sm.btn-outline-primary#reloadRejected(type='button')
                    i.fas.fa-rotate-right.me-1
                    | Update
                .card-body
                  p.text-muted.small.mb-2 Reason for rejection (if applicable)
                  p.text-muted.small.mb-3 To try again, create a new request from scratch. This work will remain in rejected status.
                  ul.list-group.list-group-flush#artistRejectedList
                    li.list-group-item.text-muted.small There are no recent rejected works.

    // BotÃ³n de volver
  section.back-navigation.py-4
    .container
      .row
        .col-12.text-center
          a.btn.btn-outline-primary.btn-lg.artist-back-btn.ox-back-btn(href="/artists" aria-label="Return")
            i.fas.fa-arrow-left.me-2
            | Return

  
  if isMyPanel
    // Modal para editar portada
    //- include ./_artistAddArtworkModal.pug
    include ./_artistCoverModal.pug
    // Modal de límite de borradores alcanzado
    .modal.fade#artistDraftLimitModal(tabindex='-1' aria-labelledby='artistDraftLimitLabel' aria-hidden='true')
      .modal-dialog
        .modal-content
          .modal-header
            h5.modal-title#artistDraftLimitLabel Draft limit reached
            button.btn-close(type='button' data-bs-dismiss='modal' aria-label='Close')
          .modal-body
            p.mb-2 You have reached the maximum number of works in draft.
            p.small.text-muted To add new works, submit some for approval or delete existing drafts.
          .modal-footer
            button.btn.btn-primary(type='button' data-bs-dismiss='modal') Understood

block scriptsExtra
  if isMyPanel
    script(src='https://unpkg.com/cropperjs@1.6.1/dist/cropper.min.js')
    script(src='/js/artist-panel.js')
