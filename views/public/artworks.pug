extends ../layouts/public

block content
  // Barra de chips + botón filtros (fragmento reutilizable)
  section.filters-toolbar.py-2
    .container-xxl.d-flex.align-items-center.flex-wrap.gap-2
      // Set variables before including the filter fragment
      - var q = typeof q !== 'undefined' ? q : {};
      - var materials = typeof materials !== 'undefined' ? materials : [];
      - var priceBounds = typeof priceBounds !== 'undefined' ? priceBounds : {};
      - var appliedPrice = typeof appliedPrice !== 'undefined' ? appliedPrice : {};
      - var actionUrl = '/artworks';
      include _artworkFilters.pug

      // ...

  // Rango aplicado (visible)
  if appliedPrice && appliedPrice.minUSD != null && appliedPrice.maxUSD != null
    .container-xxl.mb-2
      .small.text-muted
        | Mostrando: $
        = appliedPrice.minUSD.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
        |  – $
        = appliedPrice.maxUSD.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })

  // === Masonry Grid estilo Codrops ===
  section.my-5
    .container-xxl
      if artworks && artworks.length
        ul.grid.effect-2#grid
          each a in artworks
            li
              .card.h-100.bg-white.border-0.shadow-none.art-card-shadow
                a(href=`/artworks/${a.slug || a._id}`)
                  img.card-img-top.art-card-shadow(src=a.imageUrl, alt=a.title)
                .card-body.p-3.art-label.art-card-shadow
                  if a.artist
                    .fw-bold.mb-1= a.artist.name
                  if a.title
                    .mb-1= a.title
                  if a.material
                    - var matCap = a.material.charAt(0).toUpperCase() + a.material.slice(1)
                    .mb-1= matCap
                  if a.size
                    .mb-1= a.size
                  if typeof a.price_cents === 'number'
                    .mb-1
                      | $
                      = (a.price_cents/100).toLocaleString('en-US', {minimumFractionDigits:0})
                  // Website and Instagram (if available)
                  .d-flex.justify-content-between.align-items-center.mb-1
                    if a.website
                      span.small= a.website
                    if a.instagram
                      span.small= '@' + a.instagram.replace(/^@/, '')
                  // Extra info: views, date, comments, ratings
                  .d-flex.flex-wrap.gap-2.small.text-muted
                    if typeof a.views === 'number'
                      span Vistas: #{a.views}
                    if a.createdAt
                      span Fecha: #{new Date(a.createdAt).toLocaleDateString('es-MX', { year: 'numeric', month: 'short', day: 'numeric' })}
                    if typeof a.commentsCount === 'number'
                      span Comentarios: #{a.commentsCount}
                    if a.ratings && typeof a.ratings.average === 'number'
                      span Calificación: #{a.ratings.average.toFixed(1)}

        // Bootstrap-style pagination (max 51 per page, hidden until images load)
        if typeof page !== 'undefined' && typeof totalPages !== 'undefined' && totalPages > 1
          nav.mt-4.mb-4.d-flex.justify-content-center#pager-obras.pager-hidden(style="display:none" aria-label="Paginación obras")
            ul.pagination-ox.pagination-lg
              // Previous button
              li.page-item(class=page === 1 ? 'disabled' : '')
                a.page-link(href=`?page=${page-1}${q && q.sort ? `&sort=${q.sort}` : ''}${q && q.material ? `&material=${q.material}` : ''}` aria-label="Anterior")
                  span(aria-hidden="true") &laquo;
              // Page numbers (show up to 5 pages, center current)
              - var startPage = Math.max(1, page - 2);
              - var endPage = Math.min(totalPages, page + 2);
              - if (endPage - startPage < 4) {
              -   if (startPage === 1) endPage = Math.min(totalPages, startPage + 4);
              -   else if (endPage === totalPages) startPage = Math.max(1, endPage - 4);
              - }
              each p in Array(endPage - startPage + 1).fill().map((_,i) => startPage + i)
                li.page-item(class=p === page ? 'active' : '')
                  a.page-link(href=`?page=${p}${q && q.sort ? `&sort=${q.sort}` : ''}${q && q.material ? `&material=${q.material}` : ''}` aria-current=(p === page ? 'page' : false))= p
              // Next button
              li.page-item(class=page === totalPages ? 'disabled' : '')
                a.page-link(href=`?page=${page+1}${q && q.sort ? `&sort=${q.sort}` : ''}${q && q.material ? `&material=${q.material}` : ''}` aria-label="Siguiente")
                  span(aria-hidden="true") &raquo;
      else
        .text-center.py-5
          p.mb-2 No hay obras publicadas todavía.
          a.btn.btn-primary(href='/signup') ¿Eres artista? Regístrate y comparte tu obra
