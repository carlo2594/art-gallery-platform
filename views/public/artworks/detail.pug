extends /layouts/public



block content

  .container-xxl.mt-5.artwork-detail-container.artwork-detail

    .row.artwork-detail-main.mb-5.artwork-detail-row.artwork-detail__main

      // Imagen de la obra con lightbox

      .col-xl-8.artwork-detail-media.artwork-detail__media

        .artwork-image-container.mb-4.artwork-media-container.artwork-detail__media-container

          figure.art-thumb#artwork-thumb.artwork-thumb.artwork-detail__thumb(data-artwork-id=artwork._id)

            if artwork._media && artwork._media.src

              img.artwork-image-main.artwork-detail__image(

                src=artwork._media.src

                srcset=artwork._media.srcset

                sizes=artwork._media.sizes || '(max-width: 992px) 100vw, 800px'

                alt=artwork.title

                data-full=(artwork._mediaFull || artwork._media.src)

                loading='eager'

                fetchpriority='high'

                decoding='async'

                width=(artwork._media.width || artwork.imageWidth_px)

                height=(artwork._media.height || artwork.imageHeight_px)

              )

            else

              img.artwork-image-main.artwork-detail__image(

                src=artwork.imageUrl

                alt=artwork.title

                data-full=artwork.imageUrl

                loading='eager'

                fetchpriority='high'

                decoding='async'

                width=artwork.imageWidth_px

                height=artwork.imageHeight_px

              )



      // InformaciÃ³n de la obra

      .col-xl-4.artwork-detail-sidebar.artwork-detail__sidebar

        .artwork-info.ps-xl-4.px-4.text-xl-start.text-center.mx-auto.artwork-info-container.artwork-detail__info

          .d-flex.align-items-center.justify-content-center.justify-content-xl-start.gap-3.mb-3.artwork-title-wrap.artwork-detail__title-wrap

            h1.display-4.fw-bold.mb-0.artwork-title.artwork-detail__title= artwork.title

          // Meta: vistas y favoritos (debajo del título)
          .artwork-detail__stats.d-flex.align-items-center.justify-content-center.justify-content-xl-start.mb-3
            .artwork-detail__stat.me-3
              i.fas.fa-eye.me-1.artwork-detail__stat-icon
              span= (typeof artwork.views === 'number' ? artwork.views.toLocaleString('en-US') : '—')
            .artwork-detail__stat
              i.fas.fa-heart.me-1.artwork-detail__stat-icon
              span= (typeof artwork.favoritesCount === 'number' ? artwork.favoritesCount.toLocaleString('en-US') : '—')



          if artwork.artist

            .mb-3.artwork-artist-info.artwork-detail__artist

              h6.text-uppercase.fw-bold.mb-1.text-muted.artwork-artist-name.artwork-detail__artist-name

                // Siempre usar ID para que redirija al slug vigente

                a.text-decoration-none.artist-name-hover.artwork-detail__artist-link(href=`/artists/${artwork.artist._id}`)= artwork.artist.name

              if artwork.artist.location

                small.text-muted.artwork-artist-location.artwork-detail__artist-location= artwork.artist.location



          .artwork-details.mb-3.artwork-meta.artwork-detail__meta

            if artwork.description

              .mb-1.artwork-description-wrap.artwork-detail__description-wrap

                p.fs-5.text-muted.lh-base.mb-0.artwork-description.artwork-detail__description= artwork.description



            .details-list.mt-0.artwork-detail__details

              if artwork.technique

                .detail-item.mb-1.artwork-technique.artwork-detail__technique

                  span.text-muted.artwork-technique-text.artwork-detail__technique-text= artwork.technique



              - var __dt = artwork.completedAt || artwork.createdAt

              if __dt

                - var __y = (function(v){ try { var d = new Date(v); var y = d.getFullYear(); return Number.isFinite(y) ? y : null; } catch(_) { return null; } })(__dt)

                if __y

                  .detail-item.mb-1.artwork-year.artwork-detail__year

                    span.text-muted.artwork-year-text.artwork-detail__year-text= __y



              if artwork.width_cm && artwork.height_cm

                .detail-item.mb-1.artwork-dimensions.artwork-detail__dimensions

                  span.text-muted.artwork-dimensions-text.artwork-detail__dimensions-text #{artwork.width_cm} - #{artwork.height_cm} cm / #{Math.round(artwork.width_cm / 2.54)} - #{Math.round(artwork.height_cm / 2.54)} in



          if artwork.price_cents && artwork.price_cents > 0

            .mb-3.artwork-price-wrap.artwork-detail__price-wrap

              h5.fw-bold.text-dark.artwork-price.artwork-detail__price $#{(artwork.price_cents / 100).toLocaleString('en-US')} USD



          .artwork-action-section.pb-4.mb-5.border-bottom.artwork-cta-section.artwork-detail__cta-section

            .action-buttons.mb-3.artwork-action-buttons.artwork-detail__action-buttons

              - const av = artwork.availability || 'not_for_sale'

              if av === 'for_sale'

                // AcciÃ³n primaria separada para mejor jerarquÃ­a visual

                .mb-3

                  if currentUser

                    button.btn.btn-dark.btn-lg.px-4.py-3.mb-3.fw-bold.text-uppercase.btn-letter-spacing.artwork-cta-btn.artwork-detail__cta-btn(

                      type='button'

                      aria-label='Consultar compra'

                      data-bs-toggle='modal'

                      data-bs-target='#purchaseInquiryModal'

                    )

                      span CONSULTAR COMPRA

                  else

                    button.btn.btn-dark.btn-lg.px-4.py-3.mb-3.fw-bold.text-uppercase.btn-letter-spacing.artwork-cta-btn.artwork-detail__cta-btn(

                      type='button'

                      aria-label='Inicia sesión para consultar'

                      data-bs-toggle='modal'

                      data-bs-target='#purchaseAuthModal'

                    )

                      span CONSULTAR COMPRA

              // Acciones secundarias agrupadas (favorito y compartir)

              .d-flex.flex-wrap.align-items-center.gap-3.justify-content-center.justify-content-xl-start.mt-3

                if currentUser

                  button.btn.btn-outline-dark.btn-lg.px-4.py-3.rounded-pill.artwork-fav-btn.artwork-detail__fav-btn(

                    type='button'

                    aria-label='Agregar a favoritos'

                    data-artwork-id=artwork._id

                    data-favorited='false'

                  )

                    i.far.fa-heart.me-2.artwork-detail__fav-icon

                    span Favorito

                else

                  button.btn.btn-outline-dark.btn-lg.px-4.py-3.rounded-pill.artwork-fav-btn.artwork-detail__fav-btn(

                    type='button'

                    aria-label='Inicia sesión para agregar a favoritos'

                    data-bs-toggle='modal'

                    data-bs-target='#favAuthModal'

                  )

                    i.far.fa-heart.me-2.artwork-detail__fav-icon

                    span Favorito

                button.btn.btn-outline-dark.btn-lg.px-4.py-3.artwork-share-btn.artwork-detail__share-btn.ox-share-btn(type='button' aria-label='Compartir esta obra')

                  i.fas.fa-share.me-2

                  span Compartir



    if relatedArtworks && relatedArtworks.length > 0

      section.related-artworks.py-5.px-3.px-md-4.px-lg-5.related-artworks-section.artwork-detail__related-artworks

        .row

          .col-12

            h3.mb-4.related-artworks-title MÃ¡s obras de 

              // Siempre usar ID para que redirija al slug vigente

              a.text-decoration-none.artist-title-hover(href=`/artists/${artwork.artist._id}`)= artwork.artist.name

        - var artworks = relatedArtworks

        - var backTo = `/artworks/${artwork.slug || artwork._id}`

        include /public/artworks/_artworkGrid.pug



    section.back-navigation.py-4.artwork-back-section.artwork-detail__back-section

      .row.artwork-detail__back-row

        .col-12.text-center.artwork-detail__back-col

          a.btn.btn-outline-primary.btn-lg.artwork-back-btn.artwork-detail__back-btn.ox-back-btn(href="/artworks" aria-label="Volver")

            i.fas.fa-arrow-left.me-2.artwork-detail__back-icon

            span.artwork-detail__back-text Volver



  #lightbox.lightbox.artwork-lightbox.artwork-detail__lightbox(

    role="dialog"

    aria-modal="true"

    aria-label="Vista ampliada de la obra"

  )

    button.lightbox__close.artwork-lightbox-close.artwork-detail__lightbox-close(type="button" aria-label="Cerrar (Esc)")

      svg(viewBox="0 0 24 24" fill="none" aria-hidden="true")

        path(d="M18.3 5.7a1 1 0 0 1 0 1.4L13.4 12l4.9 4.9a1 1 0 1 1-1.4 1.4L12 13.4l-4.9 4.9a1 1 0 0 1-1.4-1.4l4.9-4.9-4.9-4.9A1 1 0 1 1 7.1 4.3L12 9.2l4.9-4.9a1 1 0 0 1 1.4 0Z" fill="currentColor")

      span.sr-only Cerrar

    .lightbox__inner.artwork-lightbox-inner.artwork-detail__lightbox-inner

      img#lightboxImg.lightbox__img.artwork-lightbox-img.artwork-detail__lightbox-img(alt="")



  .mt-5

    - var modalId = 'favAuthModal'

    - var title = 'Necesitas iniciar sesión'

    - var message = 'Para agregar esta obra a tus favoritos, inicia sesión o regístrate.'

    - var returnTo = `/artworks/${artwork.slug || artwork._id}`

  // Modal Auth para Favoritos (no logueado)
  .mt-5
    include /public/common/_authRequiredModal.pug

  // Modal Auth para Consultar Compra (no logueado)
  .mt-5
    include /public/common/_purchaseAuthModal.pug


  // Modal de Consulta de Compra (usuario logueado)

  if currentUser

    include /public/common/_purchaseInquiryModal.pug



block scriptsExtra

  script(src="/js/purchase-inquiry.js")



  // JS de compartir/copy movido a /js/main.js

  // script eliminado

  //

    - var returnTo = `/artworks/${artwork.slug || artwork._id}`





