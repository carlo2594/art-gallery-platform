// Filtros de obras reutilizables para artworks.pug y searchResults.pug
form#quickChips(method='GET' action=actionUrl class='d-flex flex-wrap gap-2')
  // Mantener el término de búsqueda si existe
  if typeof search !== 'undefined' && search
    input(type='hidden' name='q' value=search)
  else if q && q.q
    input(type='hidden' name='q' value=q.q)
  // Chips de orden
  -
    var opts = [
      {label: 'Relevance', value: ''},
      {label: 'Popular', value: 'popular'},
      {label: 'Recent', value: 'recent'},
      {label: 'Most Favorites', value: 'most_favorited'}
    ];
  each opt in opts
    button.chip.btn(
      type='submit'
      name='sort'
      value=opt.value
      class=(
        (!q || !q.sort) && opt.value === '' ? 'active' :
        (q && q.sort === opt.value ? 'active' : '')
      )
    )= opt.label

  // Mantener filtros adicionales cuando se usan chips rápidos
  if q && q.type
    each t in (Array.isArray(q.type)? q.type : [q.type])
      input(type='hidden' name='type' value=t)
  if q && q.technique
    each t in (Array.isArray(q.technique)? q.technique : [q.technique])
      input(type='hidden' name='technique' value=t)
  if q && (q.minw || q.maxw || q.minh || q.maxh)
    if q.minw
      input(type='hidden' name='minw' value=q.minw)
    if q.maxw
      input(type='hidden' name='maxw' value=q.maxw)
    if q.minh
      input(type='hidden' name='minh' value=q.minh)
    if q.maxh
      input(type='hidden' name='maxh' value=q.maxh)

  // Mantener disponibilidad actual si existe (para chips de orden)
  if q && q.avail
    input(type='hidden' name='avail' value=q.avail)

// Grupo derecho: chips de disponibilidad + botón de filtros
.ms-auto.d-flex.align-items-center.flex-wrap.gap-2
  // Form separado para alternar disponibilidad sin duplicar el parámetro
  form#availChips(method='GET' action=actionUrl class='d-none')
    // Mantener búsqueda
    if typeof search !== 'undefined' && search
      input(type='hidden' name='q' value=search)
    else if q && q.q
      input(type='hidden' name='q' value=q.q)
  // Mantener sort
  if q && q.sort
    input(type='hidden' name='sort' value=q.sort)
  // Mantener filtros activos
  if q && q.type
    each t in (Array.isArray(q.type)? q.type : [q.type])
      input(type='hidden' name='type' value=t)
  if q && q.technique
    each t in (Array.isArray(q.technique)? q.technique : [q.technique])
      input(type='hidden' name='technique' value=t)
  if q && (q.minw || q.maxw || q.minh || q.maxh)
    if q.minw
      input(type='hidden' name='minw' value=q.minw)
    if q.maxw
      input(type='hidden' name='maxw' value=q.maxw)
    if q.minh
      input(type='hidden' name='minh' value=q.minh)
    if q.maxh
      input(type='hidden' name='maxh' value=q.maxh)
  if q && (q.minPrice || q.maxPrice || q.minPriceCents || q.maxPriceCents)
    if q.minPrice
      input(type='hidden' name='minPrice' value=q.minPrice)
    if q.maxPrice
      input(type='hidden' name='maxPrice' value=q.maxPrice)
    if q.minPriceCents
      input(type='hidden' name='minPriceCents' value=q.minPriceCents)
    if q.maxPriceCents
      input(type='hidden' name='maxPriceCents' value=q.maxPriceCents)

    // Chips rápidos: Disponibilidad (solo 1 seleccionado)
    // Chips de venta removidos aquí; usar panel

  // Mantener rango de precio si el usuario ya filtró
  if q && (q.minPrice || q.maxPrice || q.minPriceCents || q.maxPriceCents)
    if q.minPrice
      input(type='hidden' name='minPrice' value=q.minPrice)
    if q.maxPrice
      input(type='hidden' name='maxPrice' value=q.maxPrice)
    if q.minPriceCents
      input(type='hidden' name='minPriceCents' value=q.minPriceCents)
    if q.maxPriceCents
      input(type='hidden' name='maxPriceCents' value=q.maxPriceCents)

  // No mostrar botones Limpiar/Ver resultados aquí (solo en offcanvas)

  // Offcanvas con filtros avanzados
  button.btn.btn-outline-secondary.ms-auto(data-bs-toggle='offcanvas' data-bs-target='#filtersDrawer' aria-controls='filtersDrawer')
    i.fa-solid.fa-filter.me-1
    | Filters

div.offcanvas.offcanvas-end#filtersDrawer(tabindex='-1' aria-labelledby='filtersTitle')
  .offcanvas-header
    h5#filtersTitle Filters
    button.btn-close(type='button' data-bs-dismiss='offcanvas' aria-label='Close')
  form.offcanvas-body.d-flex.flex-column.gap-4(method='GET' action=actionUrl)
    // Mantener el término de búsqueda si existe
    if typeof search !== 'undefined' && search
      input(type='hidden' name='q' value=search)
    else if q && q.q
      input(type='hidden' name='q' value=q.q)
    if q && q.type
      each t in (Array.isArray(q.type)? q.type : [q.type]) 
        input(type='hidden' name='type' value=t)
    if q && q.orientation
      each o in (Array.isArray(q.orientation)? q.orientation : [q.orientation]) 
        input(type='hidden' name='orientation' value=o)
    // Technique (multi)
    .filter-block
      label.form-label.mb-2 Technique
      .d-flex.flex-wrap.gap-2
        each t in (typeof techniques !== 'undefined' && techniques ? techniques : [])
          if t
            - var techCap = t.charAt(0).toUpperCase() + t.slice(1)
            label.chip
              input(type='checkbox' name='technique' value=t checked=(Array.isArray(q && q.technique) ? q.technique.includes(t) : (q && q.technique) === t))
              span= techCap
    // Disponibilidad
    .filter-block
      label.form-label.mb-2 Availability for sale
      .d-flex.flex-wrap.gap-2
        label.chip
          input(type='radio' name='avail' value='' checked=(!q || !q.avail))
          span All works
        label.chip
          input(type='radio' name='avail' value='available' checked=(q && q.avail==='available'))
          span On sale
        label.chip
          input(type='radio' name='avail' value='unavailable' checked=(q && q.avail==='unavailable'))
          span Not for sale
    // Tamaño en cm (rango)
    .filter-block
      label.form-label.mb-2 Size (width x height)
      .row.g-2
        .col-6
          input.form-control(type='number' name='minw' placeholder='Min width' value=(q && q.minw ? q.minw : ''))
        .col-6
          input.form-control(type='number' name='maxw' placeholder='Max width' value=(q && q.maxw ? q.maxw : ''))
        .col-6
          input.form-control(type='number' name='minh' placeholder='My alto' value=(q && q.minh ? q.minh : ''))
        .col-6
          input.form-control(type='number' name='maxh' placeholder='Max height' value=(q && q.maxh ? q.maxh : ''))
    // === NUEVO: Precio en USD ===
    .filter-block
      label.form-label.mb-2 Precio (USD)
      if typeof priceBounds !== 'undefined' && priceBounds && priceBounds.minUSD != null && priceBounds.maxUSD != null
        .small.text-muted.mb-2
          | Available range: $
          = priceBounds.minUSD.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
          |  – $
          = priceBounds.maxUSD.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
      .row.g-2
        .col-6
          input.form-control(
            type='number'
            step='0.01'
            min='0'
            name='minPrice'
            placeholder=(priceBounds && priceBounds.minUSD != null ? priceBounds.minUSD.toFixed(2) : 'Min.')
            value=(appliedPrice && appliedPrice.minUSD != null ? appliedPrice.minUSD.toFixed(2) : (q && q.minPrice ? q.minPrice : ''))
          )
        .col-6
          input.form-control(
            type='number'
            step='0.01'
            min='0'
            name='maxPrice'
            placeholder=(priceBounds && priceBounds.maxUSD != null ? priceBounds.maxUSD.toFixed(2) : 'Max.')
            value=(appliedPrice && appliedPrice.maxUSD != null ? appliedPrice.maxUSD.toFixed(2) : (q && q.maxPrice ? q.maxPrice : ''))
          )
    // Orden solo por precio
    .filter-block
      label.form-label.mb-2 Sort by price
      select.form-select(name='sort')
        option(value='') Select
        option(value='price_asc' selected=(q && q.sort==='price_asc')) Lowest to highest
        option(value='price_desc' selected=(q && q.sort==='price_desc')) Highest to lowest
    .mt-auto.d-flex.gap-2.sticky-apply
      a.btn.btn-light.flex-fill(href=actionUrl) Clean
      button.btn.btn-apply.flex-fill(type='submit') See results

