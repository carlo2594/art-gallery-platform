extends ../layouts/public

block content
  // Variables para fechas y artistas
  - var dateText = '';
  - var guestArtists = Array.isArray(exhibition && exhibition.participants) ? exhibition.participants.filter(function(p){
  -   try { return p && p.user && p.user.name && p.role && ['artista','invitado'].includes(String(p.role).toLowerCase()); } catch(e) { return false; }
  - }) : [];

  main.main-content.exhibition-detail-page
    // Hero Section (similar style to artist detail)

    section.exhibition-hero.position-relative.exhibition-hero-fullscreen
      // Imagen de fondo
      .exhibition-hero-bg-custom
        if exhibition && exhibition.coverImage
          img.exhibition-hero-bg-custom(
            src=exhibition.coverImage,
            alt=(exhibition.title || exhibition.name || 'Exposición')
          )
        else
          .hero-bg-placeholder.w-100.h-100.exhibition-gradient-bg

      // Overlay
      .exhibition-hero-overlay-custom

      // Contenido superpuesto
      .hero-content.position-absolute.bottom-0.start-0.w-100.exhibition-hero-z-index
        .container.text-white.pb-5
          .d-none.d-lg-flex.gap-4.justify-content-center.align-items-end
            // Columna 1: Título y descripción
            .flex-fill.exhibition-info-flex
              h1.display-4.fw-bold.mb-3.exhibition-title-font= title
              if exhibition && exhibition.description
                p.lead.mb-4.text-white-75.exhibition-description-style= exhibition.description

            // Columna 2: Fechas y lugar
            .flex-fill.exhibition-dates-flex
              .text-center.p-4.exhibition-info-card
                .small.text-white-75.mb-2 Fechas
                - try {
                -   var hasStart = exhibition && exhibition.startDate;
                -   var hasEnd = exhibition && exhibition.endDate;
                -   if (hasStart || hasEnd) {
                -     var sD = hasStart ? new Date(exhibition.startDate) : null;
                -     var eD = hasEnd ? new Date(exhibition.endDate) : null;
                -     var sd = hasStart ? sD.getDate() : null;
                -     var ed = hasEnd ? eD.getDate() : null;
                -     var sMonthShort = hasStart ? sD.toLocaleDateString('es-MX', { month: 'short' }) : '';
                -     var eMonthShort = hasEnd ? eD.toLocaleDateString('es-MX', { month: 'short' }) : '';
                -     var sy = hasStart ? sD.getFullYear() : null;
                -     var ey = hasEnd ? eD.getFullYear() : null;
                -     if (hasStart && hasEnd) {
                -       var sameYear = sy === ey;
                -       var sameMonth = sameYear && (sD.getMonth() === eD.getMonth());
                -       if (sameYear && sameMonth) {
                -         dateText = `${sd}–${ed} ${sMonthShort} ${sy}`;
                -       } else if (sameYear) {
                -         dateText = `${sd} ${sMonthShort} – ${ed} ${eMonthShort} ${sy}`;
                -       } else {
                -         dateText = `${sd} ${sMonthShort} ${sy} – ${ed} ${eMonthShort} ${ey}`;
                -       }
                -     } else if (hasStart) {
                -       dateText = `Desde ${sd} ${sMonthShort} ${sy}`;
                -     } else if (hasEnd) {
                -       dateText = `Hasta ${ed} ${eMonthShort} ${ey}`;
                -     }
                -   }
                - } catch(e) { console.error('Error formatting dates:', e); }
                if dateText
                  .h6.mb-0= dateText
                else
                  .small.text-white-50 Por anunciar
                hr.my-3.opacity-50
                .small.text-white-75.mb-2 Lugar
                if exhibition && exhibition.location && exhibition.location.type === 'physical'
                  .h6.mb-0= exhibition.venue || exhibition.location.address || 'Por anunciar'
                else if exhibition && exhibition.location && exhibition.location.type === 'virtual'
                  .h6.mb-0
                    span.text-white Exposición virtual
                else
                  .small.text-white-50 Por anunciar

            // Columna 3: Artistas invitados
            if guestArtists && guestArtists.length
              .flex-fill.exhibition-dates-flex
                .text-center.p-4.exhibition-info-card
                  .small.text-white-75.mb-2 Artistas invitados
                  ul.list-unstyled.mb-0
                    each p in guestArtists
                      li.text-white-75
                        if p.user && p.user.slug
                          a.text-decoration-none.exhibition-artist-link(href=`/artists/${p.user.slug}`)
                            | #{p.user.name}
                        else
                          | #{p.user && p.user.name}

    // Contenido móvil (titulo, fechas, bio) – visible solo en < lg
    section.exhibition-mobile.d-lg-none.py-5.exhibition-mobile-bg
      .container
        .row
          .col-12.text-center.mb-4
            h1.display-4.fw-bold.mb-2.exhibition-mobile-title= title
            if dateText
              h2.h5.mb-3.text-muted.exhibition-mobile-date= dateText
            if exhibition && exhibition.description
              p.lead.mb-0.text-dark.exhibition-mobile-description= exhibition.description

        .row.mt-4
          .col-12.text-center
            .card.shadow-sm.border-0.mx-auto.exhibition-mobile-card
              .card-body.p-4
                if exhibition && exhibition.location && exhibition.location.type === 'physical'
                  .d-flex.flex-column.align-items-center
                    .mb-2
                      i.fas.fa-map-marker-alt.fa-2x.text-primary
                    .h6.mb-0.text-dark.exhibition-venue-text= exhibition.venue || exhibition.location.address || 'Por anunciar'
                    .small.text-muted Ubicación física
                else if exhibition && exhibition.location && exhibition.location.type === 'virtual'
                  .d-flex.flex-column.align-items-center
                    .mb-2
                      i.fas.fa-globe.fa-2x.text-primary
                    .h6.mb-0.text-dark.exhibition-venue-text Exposición virtual
                else
                  .d-flex.flex-column.align-items-center
                    .mb-2
                      i.fas.fa-map-marker-alt.fa-2x.text-muted
                    .h6.mb-0.text-muted.exhibition-venue-text Por anunciar
                    .small.text-muted Ubicación pendiente

        // Artistas invitados (móvil)
        if guestArtists && guestArtists.length
          .row.mt-5
            .col-12.text-center
              .card.shadow-sm.border-0.mx-auto.exhibition-guests-card
                .card-body.p-4
                  .h6.mb-3.exhibition-guests-title 
                    i.fas.fa-users.me-2
                    | Artistas invitados
                  .d-flex.flex-wrap.justify-content-center.gap-2
                    each p in guestArtists
                      if p.user && p.user.slug
                        a.badge.bg-light.text-dark.px-3.py-2.text-decoration-none.exhibition-artist-badge(href=`/artists/${p.user.slug}`)
                          | #{p.user.name}
                      else
                        .badge.bg-light.text-dark.px-3.py-2.exhibition-guest-badge= p.user && p.user.name

    // Obras de la exposición
    if artworks && artworks.length > 0
      section.exhibition-artworks.py-5.exhibition-artworks-bg
        .container
          .row.mb-5
            .col-12.text-center
              h2.section-title.display-5.fw-bold.mb-3.artist-section-title Obras en esta exposición
              - var displayText = (typeof totalArtworks !== 'undefined' && typeof artworks !== 'undefined') ? (artworks.length === totalArtworks ? `${totalArtworks} obra${totalArtworks === 1 ? '' : 's'}` : `Mostrando ${artworks.length} de ${totalArtworks} obras`) : `${artworks.length} obra${artworks.length === 1 ? '' : 's'}`
              p.lead.text-muted= displayText

        .container-xxl.artworks-flex.artist-container-padding
          .artworks-grid-paginate
            include _artworkGrid.pug
            if typeof totalPages !== 'undefined' && totalPages > 1
              include _artworkPagination.pug
    else
      section.no-artworks.py-5.text-center
        .container
          i.fas.fa-images.fa-3x.text-muted.mb-3
          h3.h4.mb-2.text-muted No hay obras asociadas a esta exposición
          p.text-muted Vuelve pronto para descubrir nuevas piezas.

    // Botón para volver
    section.back-navigation.py-4
      .container
        .row
          .col-12.text-center
            a.btn.btn-outline-primary.btn-lg.exhibition-back-btn(href="/exhibitions")
              i.fas.fa-arrow-left.me-2
              | Volver a Exposiciones
