// Filtros de obras reutilizables para artworks.pug y searchResults.pug
form#quickChips(method='GET' action=actionUrl class='d-flex flex-wrap gap-2')
  // Mantener el término de búsqueda si existe
  if typeof search !== 'undefined' && search
    input(type='hidden' name='q' value=search)
  else if q && q.q
    input(type='hidden' name='q' value=q.q)
  // Chips de orden
  - var opts = [{label: 'Relevancia', value: ''}, {label: 'Populares', value: 'popular'}, {label: 'Recientes', value: 'recent'}]
  each opt in opts
    button.chip.btn(
      type='submit'
      name='sort'
      value=opt.value
      class=(
        (!q || !q.sort) && opt.value === '' ? 'active' :
        (q && q.sort === opt.value ? 'active' : '')
      )
    )= opt.label

  // Mantener rango de precio si el usuario ya filtró
  if q && (q.minPrice || q.maxPrice || q.minPriceCents || q.maxPriceCents)
    if q.minPrice
      input(type='hidden' name='minPrice' value=q.minPrice)
    if q.maxPrice
      input(type='hidden' name='maxPrice' value=q.maxPrice)
    if q.minPriceCents
      input(type='hidden' name='minPriceCents' value=q.minPriceCents)
    if q.maxPriceCents
      input(type='hidden' name='maxPriceCents' value=q.maxPriceCents)

  // No mostrar botones Limpiar/Ver resultados aquí (solo en offcanvas)

// Offcanvas con filtros avanzados
button.btn.btn-outline-secondary.ms-auto(data-bs-toggle='offcanvas' data-bs-target='#filtersDrawer' aria-controls='filtersDrawer')
  i.fa-solid.fa-filter.me-1
  | Filtros

div.offcanvas.offcanvas-end#filtersDrawer(tabindex='-1' aria-labelledby='filtersTitle')
  .offcanvas-header
    h5#filtersTitle Filtros
    button.btn-close(type='button' data-bs-dismiss='offcanvas' aria-label='Cerrar')
  form.offcanvas-body.d-flex.flex-column.gap-4(method='GET' action=actionUrl)
    // Mantener el término de búsqueda si existe
    if typeof search !== 'undefined' && search
      input(type='hidden' name='q' value=search)
    else if q && q.q
      input(type='hidden' name='q' value=q.q)
    if q && q.type
      each t in (Array.isArray(q.type)? q.type : [q.type]) 
        input(type='hidden' name='type' value=t)
    if q && q.orientation
      each o in (Array.isArray(q.orientation)? q.orientation : [q.orientation]) 
        input(type='hidden' name='orientation' value=o)
    // Material (multi)
    .filter-block
      label.form-label.mb-2 Material
      .d-flex.flex-wrap.gap-2
        each m in (typeof materials !== 'undefined' && materials ? materials : [])
          if m
            - var matCap = m.charAt(0).toUpperCase() + m.slice(1)
            label.chip
              input(type='checkbox' name='material' value=m checked=(Array.isArray(q && q.material) ? q.material.includes(m) : (q && q.material) === m))
              span= matCap
    // Tamaño en cm (rango)
    .filter-block
      label.form-label.mb-2 Tamaño (ancho x alto)
      .row.g-2
        .col-6
          input.form-control(type='number' name='minw' placeholder='Ancho mín.' value=(q && q.minw ? q.minw : ''))
        .col-6
          input.form-control(type='number' name='maxw' placeholder='Ancho máx.' value=(q && q.maxw ? q.maxw : ''))
        .col-6
          input.form-control(type='number' name='minh' placeholder='Alto mín.' value=(q && q.minh ? q.minh : ''))
        .col-6
          input.form-control(type='number' name='maxh' placeholder='Alto máx.' value=(q && q.maxh ? q.maxh : ''))
    // === NUEVO: Precio en USD ===
    .filter-block
      label.form-label.mb-2 Precio (USD)
      if typeof priceBounds !== 'undefined' && priceBounds && priceBounds.minUSD != null && priceBounds.maxUSD != null
        .small.text-muted.mb-2
          | Rango disponible: $
          = priceBounds.minUSD.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
          |  – $
          = priceBounds.maxUSD.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
      .row.g-2
        .col-6
          input.form-control(
            type='number'
            step='0.01'
            min='0'
            name='minPrice'
            placeholder=(priceBounds && priceBounds.minUSD != null ? priceBounds.minUSD.toFixed(2) : 'Mín.')
            value=(appliedPrice && appliedPrice.minUSD != null ? appliedPrice.minUSD.toFixed(2) : (q && q.minPrice ? q.minPrice : ''))
          )
        .col-6
          input.form-control(
            type='number'
            step='0.01'
            min='0'
            name='maxPrice'
            placeholder=(priceBounds && priceBounds.maxUSD != null ? priceBounds.maxUSD.toFixed(2) : 'Máx.')
            value=(appliedPrice && appliedPrice.maxUSD != null ? appliedPrice.maxUSD.toFixed(2) : (q && q.maxPrice ? q.maxPrice : ''))
          )
    // Orden solo por precio
    .filter-block
      label.form-label.mb-2 Ordenar por precio
      select.form-select(name='sort')
        option(value='') Selecciona
        option(value='price_asc' selected=(q && q.sort==='price_asc')) Menor a mayor
        option(value='price_desc' selected=(q && q.sort==='price_desc')) Mayor a menor
    .mt-auto.d-flex.gap-2.sticky-apply
      a.btn.btn-light.flex-fill(href=actionUrl) Limpiar
      button.btn.btn-apply.flex-fill(type='submit') Ver resultados
