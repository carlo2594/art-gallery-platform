// views/public/_artworkPagination.pug
// Requiere: page, totalPages, q, (opcional: search, tab)
// Uso: include _artworkPagination.pug
if typeof page !== 'undefined' && typeof totalPages !== 'undefined' && totalPages > 1
  - var navAttrs = { class: 'mt-4 mb-4 d-flex justify-content-center', id: 'pager-obras', 'aria-label': 'Paginaci√≥n obras' };
  - if (typeof tab !== 'undefined') navAttrs['data-tab'] = tab;
  // Build persistent query string with current filters
  - var qsParts = [];
  - var add = function(k, v) { if (v !== undefined && v !== null && v !== '') qsParts.push(`${k}=${encodeURIComponent(v)}`) };
  // Search term
  if typeof search !== 'undefined'
    - add('q', search || '')
  else if q && q.q
    - add('q', q.q)
  // Current tab (for /search)
  if typeof tab !== 'undefined'
    - add('tab', tab)
  // Core filters
  if q && q.sort
    - add('sort', q.sort)
  if q && q.avail
    - add('avail', q.avail)
  if q && q.type
    - (Array.isArray(q.type) ? q.type : [q.type]).forEach(function(t){ if (t) { qsParts.push(`type=${encodeURIComponent(t)}`) } })
  if q && q.orientation
    - (Array.isArray(q.orientation) ? q.orientation : [q.orientation]).forEach(function(o){ if (o) { qsParts.push(`orientation=${encodeURIComponent(o)}`) } })
  if q && q.technique
    - (Array.isArray(q.technique) ? q.technique : [q.technique]).forEach(function(t){ if (t) { qsParts.push(`technique=${encodeURIComponent(t)}`) } })
  // Dimensions
  if q && q.minw
    - add('minw', q.minw)
  if q && q.maxw
    - add('maxw', q.maxw)
  if q && q.minh
    - add('minh', q.minh)
  if q && q.maxh
    - add('maxh', q.maxh)
  // Price (both USD and cents if present)
  if q && q.minPrice
    - add('minPrice', q.minPrice)
  if q && q.maxPrice
    - add('maxPrice', q.maxPrice)
  if q && q.minPriceCents
    - add('minPriceCents', q.minPriceCents)
  if q && q.maxPriceCents
    - add('maxPriceCents', q.maxPriceCents)
  - var qsCommon = qsParts.length ? ('&' + qsParts.join('&')) : '';
  nav(&attributes(navAttrs))
    ul.pagination-ox.pagination-lg
      // Previous button
      li.page-item(class=page === 1 ? 'disabled' : '')
        a.page-link(href=`?page=${page-1}${qsCommon}` aria-label="Anterior")
          span(aria-hidden="true") &laquo;
      // Page numbers (show up to 5 pages, center current)
      - var startPage = Math.max(1, page - 2);
      - var endPage = Math.min(totalPages, page + 2);
      - if (endPage - startPage < 4) {
      -   if (startPage === 1) endPage = Math.min(totalPages, startPage + 4);
      -   else if (endPage === totalPages) startPage = Math.max(1, endPage - 4);
      - }
      each p in Array(endPage - startPage + 1).fill().map((_,i) => startPage + i)
        li.page-item(class=p === page ? 'active' : '')
          a.page-link(href=`?page=${p}${qsCommon}` aria-current=(p === page ? 'page' : false))= p
      // Next button
      li.page-item(class=page === totalPages ? 'disabled' : '')
        a.page-link(href=`?page=${page+1}${qsCommon}` aria-label="Siguiente")
          span(aria-hidden="true") &raquo;

