extends ../../layouts/admin

block content
  .container.py-5
    h1.h3.mb-4.d-flex.justify-content-between.align-items-center
      span= title || 'Usuarios'
      // Bot칩n para abrir modal de nuevo usuario
      button.btn.btn-success.btn-sm(type='button', data-bs-toggle='modal', data-bs-target='#adminCreateUser')
        i.fas.fa-user-plus.me-1
        | Agregar usuario
    // Barra de b칰squeda
    form.row.gy-2.gx-2.align-items-center.mb-3(method='GET')
      .col-sm-8.col-md-6
        input.form-control(type='text', name='q', placeholder='Buscar por nombre o correo', value=q || '')
      if typeof role !== 'undefined' && role
        input(type='hidden', name='role', value=role)
      .col-sm-6.col-md-3
        select.form-select(name='active')
          option(value='') Estado: Todos
          option(value='active' selected=active === 'active') Activos
          option(value='inactive' selected=active === 'inactive') Inactivos
      .col-sm-6.col-md-3
        select.form-select(name='img')
          option(value='') Imagen: Todas
          option(value='with' selected=img === 'with') Con imagen
          option(value='without' selected=img === 'without') Sin imagen
      .col-sm-6.col-md-3
        select.form-select(name='sort')
          option(value='recent' selected=sort === 'recent') Recientes primero
          option(value='oldest' selected=sort === 'oldest') Antiguos primero
          option(value='name_asc' selected=sort === 'name_asc') Nombre A-Z
          option(value='name_desc' selected=sort === 'name_desc') Nombre Z-A
          option(value='last_login' selected=sort === 'last_login') ￦timo acceso
      .col-auto
        button.btn.btn-primary(type='submit') Buscar
      if q
        .col-auto
          a.btn.btn-outline-secondary(href='?') Limpiar
    
    if users && users.length
      .table-responsive
        table.table.table-striped.table-hover.align-middle.admin-users-table
          thead
            tr
              th Nombre
              th Correo
              th Estado
              th Creado
              th Editar
              th Acciones
          tbody
            each u in users
              tr
                td= u.name
                td= u.email
                td
                  span.badge(class=u.active === false ? 'text-bg-secondary' : 'text-bg-success')= (u.active === false ? 'Inactivo' : 'Activo')
                td= new Date(u.createdAt).toLocaleDateString('es-ES')
                // Columna Editar
                td
                  button.btn.btn-sm.btn-outline-primary.admin-users-edit-trigger(type='button', data-bs-toggle='modal', data-bs-target=`#adminEditUser-${u._id}`, data-user-name=u.name, data-user-email=u.email)
                    i.fas.fa-pen-to-square.me-1
                    | Editar
                  // Modal de edici蚤 por usuario (extra顔o)
                  include ../../admin/modals/_userEditModal.pug
                td
                  // Bot칩n que abre el modal de acciones
                  button.btn.btn-sm.btn-outline-secondary(type='button', data-bs-toggle='modal', data-bs-target=`#userActions-${u._id}`) Ver
                  // Modal de acciones por usuario (extra顔o)
                  include ../../admin/modals/_userActionsModal.pug

    else
      .alert.alert-info No hay usuarios
    if typeof totalPages !== 'undefined' && totalPages > 1
      nav.mt-4(aria-label=`Paginaci칩n de ${title || 'usuarios'}`)
        ul.pagination.justify-content-center
          - const prevDisabled = page <= 1
          - const nextDisabled = page >= totalPages
          li.page-item(class=prevDisabled ? 'disabled' : '')
            a.page-link(href=`?page=${page-1}${qsPrefix || ''}` aria-label='Anterior') Anterior
          li.page-item.disabled
            span.page-link= `P치gina ${page} de ${totalPages}`
          li.page-item(class=nextDisabled ? 'disabled' : '')
            a.page-link(href=`?page=${page+1}${qsPrefix || ''}` aria-label='Siguiente') Siguiente

    // Modal: Crear nuevo usuario (extra顔o)
    include ../../admin/modals/_userCreateModal.pug
