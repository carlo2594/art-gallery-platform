// Modal de acciones por usuario (usa variable local `u`)
.modal.fade(id=`userActions-${u._id}` tabindex='-1' aria-labelledby=`userActionsLabel-${u._id}` aria-hidden='true')
  .modal-dialog
    .modal-content
      .modal-header
        h5.modal-title(id=`userActionsLabel-${u._id}`) Actions - #{u.name}
        button.btn-close(type='button' data-bs-dismiss='modal' aria-label='Close')
      .modal-body
        h2.fs-5 Security actions
        p
          button.btn.btn.warning.admin-reset-pass(type='button' data-user-id=u._id aria-label='Reset password')
            i.fas.fa-key.me-1
            | Reset password
        hr
        h2.fs-5 Manage roles
        - const roleOptions = (typeof availableRoles !== 'undefined' && Array.isArray(availableRoles) && availableRoles.length) ? availableRoles : ['collector','artist','admin']
        - const userRoles = Array.isArray(u.roles) && u.roles.length ? u.roles : (u.role ? [u.role] : [])
        form.admin-user-roles-form(data-user-id=u._id)
          .d-flex.flex-column.gap-2
            each roleValue in roleOptions
              - const checkboxId = `userRole-${u._id}-${roleValue}`
              - const labelText = roleValue.charAt(0).toUpperCase() + roleValue.slice(1)
              .form-check
                input.form-check-input(
                  type='checkbox'
                  id=checkboxId
                  name='roles'
                  data-role-checkbox=true
                  value=roleValue
                  checked=userRoles.includes(roleValue))
                label.form-check-label(for=checkboxId)= labelText
          .form-text.small.mb-2 Select at least one role. Admins retain their privileges unless removed explicitly.
          button.btn.btn-primary.w-100.admin-save-roles(type='button' data-user-id=u._id)
            i.fas.fa-floppy-disk.me-1
            | Save roles
        hr
        h2.fs-5 Account status
        p
          if u.active === false
            button.btn.btn-success.admin-toggle-active(type='button' data-user-id=u._id data-action='reactivate' aria-label='Reactivate user')
              i.fas.fa-user-check.me-1
              | Reactivate account
          else
            button.btn.btn-outline-secondary.admin-toggle-active(type='button' data-user-id=u._id data-action='deactivate' aria-label='Deactivate user')
              i.fas.fa-user-slash.me-1
              | Deactivate account
      .modal-footer
        // Usar ID para que la vista pública canonicé al slug actual
        a.btn.btn-outline-secondary.admin-users-public-link(target='_blank' href=`/artists/${u._id}`)
          i.fas.fa-user.me-1
          | View public
        button.btn.btn-secondary(type='button' data-bs-dismiss='modal') Close
