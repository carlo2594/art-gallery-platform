extends /layouts/public




block content
  .container.py-4
    // Saludo simple
    .d-flex.align-items-center.mb-4.gap-3
      - const uname = (locals.currentUser && (locals.currentUser.firstName || locals.currentUser.name)) || 'Artist'
      .avatar-circle.d-flex.align-items-center.justify-content-center(style="width:64px;height:64px;border-radius:50%;background:#EEE;color:#555;font-weight:700")
        = uname.charAt(0).toUpperCase()
      .flex-grow-1
        h2.mb-0 Welcome back, #{uname}
        p.text-muted.mb-0 Explore what's new and pick up where you left off

    // Obras recientes (prioridad alta)
    section.mb-5
      .d-flex.align-items-center.justify-content-between.mb-2
        h3.mb-0 Recent works
        a.btn.btn-sm.btn-outline-secondary(href="/artworks") See all
      if recentWorks && recentWorks.length
        - var artworks = recentWorks.slice(0, 6)
        - var gridId = 'grid-recent'
        - var firstEagerCount = 2
        include /public/artworks/_artworkGrid.pug
      else
        p.text-muted There are no recent works yet.

    // Populares (prioridad media/baja)
    section.mb-5
      .d-flex.align-items-center.justify-content-between.mb-2
        h3.mb-0 Popular this week
        a.btn.btn-sm.btn-outline-secondary(href="/artworks?sort=popular") See all
      if popularWorks && popularWorks.length
        - var artworks = popularWorks.slice(0, 6)
        - var gridId = 'grid-popular'
        - var firstEagerCount = 0
        include /public/artworks/_artworkGrid.pug
      else
        p.text-muted No popular data for now.

    // Exposiciones próximas
    section.mb-5
      .d-flex.align-items-center.justify-content-between.mb-2
        h3.mb-0 Upcoming exhibitions
        a.btn.btn-sm.btn-outline-secondary(href="/exhibitions") See all
      if upcomingExhibitions && upcomingExhibitions.length
        - var exs = upcomingExhibitions.slice(0, 3)
        - var carouselId = 'carouselExhibitions'
        .position-relative
          .carousel.slide.carousel-fade.home-exhibitions-carousel(id=carouselId data-bs-ride='carousel')
            if exs.length > 1
              .carousel-indicators
                each ex, idx in exs
                  button(type='button', data-bs-target=`#${carouselId}`, data-bs-slide-to=idx, class=(idx === 0 ? 'active' : null), aria-current=(idx === 0 ? 'true' : null), aria-label=`Slide ${idx + 1}`)
            .carousel-inner
              each ex, idx in exs
                .carousel-item(class=(idx === 0 ? 'active' : null))
                  a.d-block.text-decoration-none(href=`/exhibitions/${ex.slug || ex._id}`)
                    if ex.coverImage
                      img.d-block.w-100(src=ex.coverImage, alt=ex.title, loading='lazy', decoding='async', fetchpriority='low')
                    else
                      .d-flex.align-items-center.justify-content-center(style='height: var(--carousel-h); background:#EEE; color:#666;')= ex.title
                    .carousel-caption
                      .container
                        .row
                          .col-12.col-lg-10.col-xl-8.mx-auto
                            .exhibition-hero-info.text-white.pb-3.pb-lg-4.exhibition-hero-card.p-3.p-lg-4
                              h3.h2.fw-bold.mb-2.exhibition-title-font= ex.title
                              if ex.description
                                p.lead.mb-3.text-white-75.exhibition-description-style= ex.description
                              hr.my-2.opacity-50
                              .row.g-3
                                .col-12.col-lg-6
                                  .small.text-white-75.mb-1 Dates
                                  - let sD = ex.startDate ? new Date(ex.startDate) : null
                                  - let eD = ex.endDate ? new Date(ex.endDate) : null
                                  - if (sD && isNaN(sD.getTime())) sD = null
                                  - if (eD && isNaN(eD.getTime())) eD = null
                                  - const months = ['ene','feb','mar','abr','may','jun','jul','ago','sep','oct','nov','dic']
                                  - const fmt = (d) => `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`
                                  - const rangeText = (function(){
                                  -   if (sD && eD) {
                                  -     const sameYear = sD.getFullYear() === eD.getFullYear()
                                  -     const sameMonth = sameYear && sD.getMonth() === eD.getMonth()
                                  -     if (sameMonth) return `${sD.getDate()}–${eD.getDate()} ${months[sD.getMonth()]} ${sD.getFullYear()}`
                                  -     if (sameYear) return `${sD.getDate()} ${months[sD.getMonth()]}–${eD.getDate()} ${months[eD.getMonth()]} ${sD.getFullYear()}`
                                  -     return `${fmt(sD)}–${fmt(eD)}`
                                  -   } else if (sD) {
                                  -     return fmt(sD)
                                  -   } else if (eD) {
                                  -     return fmt(eD)
                                  -   }
                                  -   return ''
                                  - })()
                                  .h6.mb-0= rangeText || 'To be defined'
                                .col-12.col-lg-6
                                  .small.text-white-75.mb-1 Place
                                  .h6.mb-0.exhibition-detail__venue
                                    if ex.location && (ex.location.address || ex.location.url)
                                      span.text-white= ex.location.address || 'Virtual exhibition'
                                    else if ex.location && ex.location.type
                                      span.text-white= ex.location.type === 'virtual' ? 'Virtual exhibition': 'To be defined'
                                    else
                                      span.text-white To be defined
                        //- Se omite la lista de artistas en el carrusel de home para simplificar
            if exs.length > 1
              button.carousel-control-prev(type='button', data-bs-target=`#${carouselId}`, data-bs-slide='prev')
                span.carousel-control-prev-icon(aria-hidden='true')
                span.visually-hidden Anterior
              button.carousel-control-next(type='button', data-bs-target=`#${carouselId}`, data-bs-slide='next')
                span.carousel-control-next-icon(aria-hidden='true')
                span.visually-hidden Following
      else
        p.text-muted There are no upcoming exhibitions.

    // Artistas destacados
    section.mb-4
      .d-flex.align-items-center.justify-content-between.mb-2
        h3.mb-0 Featured artists
        a.btn.btn-sm.btn-outline-secondary(href="/artists") See all
      if featuredArtists && featuredArtists.length
        .row.row-cols-2.row-cols-md-4.row-cols-lg-6.g-3
          each a in featuredArtists
            .col
              a.text-decoration-none.d-block.text-center(href=`/artists/${a.slug || a._id}`)
                if a.profileImage
                  img.rounded-circle.mb-2(src=a.profileImage, alt=a.name, loading='lazy', decoding='async', fetchpriority='low', style='width:80px;height:80px;object-fit:cover;')
                else
                  .rounded-circle.mb-2.d-inline-flex.align-items-center.justify-content-center(style='width:80px;height:80px;background:#EEE;color:#666;font-weight:700')= (a.name||'A').charAt(0).toUpperCase()
                div.fw-semibold= a.name
                if typeof a.followersCount !== 'undefined'
                  div.text-muted.small #{a.followersCount} followers
      else
        p.text-muted We will soon be highlighting artists here.
