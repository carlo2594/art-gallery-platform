//- views/layouts/public.pug
doctype html
html.no-js(lang='es')
  head
    title #{title || 'Galería del Ox'}
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible' content='IE=edge,chrome=1')
    meta(name='viewport' content='width=device-width, initial-scale=1')
    //- SEO base
    - var __siteName = 'Galería del Ox'
    - var __metaTitle = (typeof metaTitle !== 'undefined' && metaTitle) ? metaTitle : (title || __siteName)
    - var __defaultDesc = 'Galería del Ox: un espacio vivo de inspiración, expresión y conexión. Arte original, exposiciones y comunidad.'
    - var __metaDescription = (typeof metaDescription !== 'undefined' && metaDescription) ? metaDescription : __defaultDesc
    meta(name='description' content=__metaDescription)

    //- CSS de Bootstrap y tus estilos
    link(rel='preconnect' href='https://fonts.googleapis.com')
    link(rel='preconnect' href='https://fonts.gstatic.com' crossorigin)
    //- Preconnect al CDN de imágenes (Cloudinary)
    link(rel='preconnect' href='https://res.cloudinary.com')
    //- Fonts: add Montserrat for artwork cards
    link(rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Newsreader:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Montserrat:wght@400;500;600;700&display=swap')
    link(rel='stylesheet' href='/bootstrap/css/bootstrap.min.css')
    link(rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css')
    link(rel='stylesheet' href='/css/component.css')
    link(rel='stylesheet' href='/css/style.css')
    //- Favicon (evita 404 en /favicon.ico)
    link(rel='icon' type='image/png' href='/Logos/GOX_LOGO_06.png')
    script(src='/js/modernizr.custom.js')
    //- Cargar axios y shim temprano para que inline scripts lo usen
    script(src='https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js')
    script(src='/js/http.js')

    //- Permite que las vistas inyecten CSS/JS extra en <head>
    block headExtra

    //- Open Graph / Twitter Cards (después de headExtra para permitir overrides)
    - var __urlPrefix = (typeof siteUrlPrefix !== 'undefined' && siteUrlPrefix) ? siteUrlPrefix : ''
    - var __path = (typeof currentPath !== 'undefined' && currentPath) ? currentPath : '/'
    - var __metaUrl = (typeof metaUrl !== 'undefined' && metaUrl) ? metaUrl : (__urlPrefix ? (__urlPrefix + __path) : __path)
    - var __rawImg = (typeof metaImage !== 'undefined' && metaImage) ? metaImage : '/img/Ox-hero-image-landing.jpg'
    - var __metaImage = (__rawImg && (__rawImg.startsWith('http://') || __rawImg.startsWith('https://'))) ? __rawImg : (__urlPrefix ? (__urlPrefix + __rawImg) : __rawImg)
    - var __metaType = (typeof metaType !== 'undefined' && metaType) ? metaType : 'website'
    meta(property='og:title' content=__metaTitle)
    meta(property='og:description' content=__metaDescription)
    meta(property='og:image' content=__metaImage)
    meta(property='og:url' content=__metaUrl)
    meta(property='og:type' content=__metaType)
    meta(property='og:site_name' content=__siteName)
    meta(property='og:locale' content='es_ES')
    meta(name='twitter:card' content='summary_large_image')
    meta(name='twitter:title' content=__metaTitle)
    meta(name='twitter:description' content=__metaDescription)
    meta(name='twitter:image' content=__metaImage)
    link(rel='canonical' href=__metaUrl)

  body(class=hideGlobalOverlay ? '' : 'loading')
    // Overlay de carga global (opcional)
    if !hideGlobalOverlay
      #page-loading-overlay.page-loading-overlay
        .loading-spinner
        .loading-text Cargando…
    if !hideNavbar
      //- Navbar: Expande a partir de lg (colapsa < 992px)
      nav.navbar.navbar-expand-xxl.main-navbar(aria-label='Navbar principal')
        .container-fluid.navbar-container
          //- Marca (logo + título)
          a.navbar-brand.d-flex.align-items-center.navbar-logo-link.order-1(href='/')
            img.logo-navbar(src='/Logos/GOX_LOGO_06.png' alt='Galería del Ox')
            h1.ms-1.text-uppercase.fw-bold.navbar-title Galería del Ox

          //- Contenido colapsable (buscador + links)
          .collapse.navbar-collapse#navbarsExample05.text-center.order-3.order-lg-2
            //- Buscador — centrado en mobile, centrado entre brand y links en desktop
            form.d-flex.flex-grow-1.flex-lg-grow-0.mx-auto.mx-lg-auto.my-3.my-lg-0(action='/search' method='GET' role='search' aria-label='Buscar')
              input.form-control.searchbar-input(type='search', name='q', placeholder='Buscar', aria-label='Buscar')

            //- Links principales — centrados en mobile, a la derecha en desktop
            ul.navbar-nav.navbar-links.mx-auto.mx-lg-0.ms-lg-auto.mb-2.mb-lg-0.fs-5
              li.nav-item
                a.nav-link.me-lg-3(href='/artworks') Obras
              li.nav-item
                a.nav-link.me-lg-3(href='/artists') Artistas
              li.nav-item
                a.nav-link.me-lg-3(href='/exhibitions') Exposiciones
              if currentUser && currentUser.role === 'artist'
                li.nav-item
                  a.nav-link.me-lg-3(href='/artists/panel' aria-label='Panel de artista') Panel de artista
              if currentUser
                li.nav-item
                  a.nav-link.me-lg-3(href='/activity') Actividad

              if !currentUser
                li.nav-item
                  a.nav-link(href='/login' aria-label='Iniciar sesión') Iniciar sesión
                li.nav-item
                  a.nav-link.nav-link-registrarse(href='/signup' aria-label='Registrarse') Registrarse

          //- Iconos (avatar + hamburguesa) agrupados a la derecha
          .navbar-icons.d-flex.align-items-center.ms-auto.order-2.order-lg-3
            if currentUser
              //- Desktop: dropdown clásico
              .dropdown.d-none.d-xxl-block
                a.nav-link.dropdown-toggle.nav-user-avatar#userMenuDesktopToggle(
                  href='#'
                  role='button'
                  data-bs-toggle='dropdown'
                  aria-expanded='false'
                  aria-label='Menú de usuario')
                  if currentUser && currentUser.profileImage
                    img.nav-user-avatar-img.rounded-circle(
                      src=currentUser.profileImage
                      alt=currentUser.name || 'Foto de perfil'
                      width='40'
                      height='40'
                      loading='lazy'
                      decoding='async')
                  else
                    span.nav-user-avatar-fallback.rounded-circle
                      i.fas.fa-user
                ul.dropdown-menu.dropdown-menu-end(aria-labelledby='userMenuDesktop')
                  li
                    a.dropdown-item.nav-user-menu-link.mb-2(href='/edit-profile' aria-label='Editar cuenta') Editar cuenta
                  if currentUser && currentUser.role === 'artist'
                    li
                      a.dropdown-item.nav-user-menu-link.mb-2(href='/artists/panel' aria-label='Panel de artista') Panel de artista
                  if currentUser && currentUser.role === 'admin'
                    li
                      a.dropdown-item.nav-user-menu-link.mb-2(href='/admin' aria-label='Panel de administrador') Panel de administrador
                  li
                    hr.dropdown-divider.my-2
                  li
                    form(action='/api/v1/auth/logout' method='POST')
                      button.dropdown-item(type='submit' aria-label='Cerrar sesión') Cerrar sesión

              //- Mobile: menú tipo hamburguesa con las opciones de usuario
              button.nav-link.nav-user-avatar.nav-user-avatar-btn.d-flex.d-xxl-none.border-0.bg-transparent.p-0#userMenuMobileToggle(
                type='button'
                data-bs-toggle='collapse'
                data-bs-target='#navUserMobile'
                aria-controls='navUserMobile'
                aria-expanded='false'
                aria-label='Menú de usuario')
                if currentUser && currentUser.profileImage
                  img.nav-user-avatar-img.rounded-circle(
                    src=currentUser.profileImage
                    alt=currentUser.name || 'Foto de perfil'
                    width='40'
                    height='40'
                    loading='lazy'
                    decoding='async')
                else
                  span.nav-user-avatar-fallback.rounded-circle
                    i.fas.fa-user

            //- Botón hamburguesa (visible solo en pantallas pequeñas)
            button.navbar-toggler.ms-2#mainMenuToggle(
              type='button'
              data-bs-toggle='collapse'
              data-bs-target='#navbarsExample05'
              aria-controls='navbarsExample05'
              aria-expanded='false'
              aria-label='Abrir menú')
              span.navbar-toggler-icon

      //- Menú de usuario mobile (estilo hamburguesa)
      if currentUser
        .collapse.navbar-collapse.d-xxl-none#navUserMobile.text-center
          ul.navbar-nav.flex-column.mx-auto.mb-2.fs-5
            li.nav-item
              a.nav-link.nav-user-menu-link(href='/edit-profile' aria-label='Editar cuenta') Editar cuenta
            if currentUser && currentUser.role === 'artist'
              li.nav-item
                a.nav-link.nav-user-menu-link(href='/artists/panel' aria-label='Panel de artista') Panel de artista
            if currentUser && currentUser.role === 'admin'
              li.nav-item
                a.nav-link.nav-user-menu-link(href='/admin' aria-label='Panel de administrador') Panel de administrador
            li.nav-item.mt-2
              form(action='/api/v1/auth/logout' method='POST')
                button.btn.btn-outline-danger.nav-user-logout-btn(type='submit' aria-label='Cerrar sesion') Cerrar sesion

      .main-content
        block content

    //- Overlays de navbar (menA�s principal y de usuario)
  #navMainOverlay.lightbox.nav-overlay(
      role='dialog'
      aria-modal='true'
      aria-label='MenA� de navegaciA3n')
      button.lightbox__close.nav-overlay__close(type='button' aria-label='Cerrar menA� de navegaciA3n')
        svg(viewBox='0 0 24 24' fill='none' aria-hidden='true')
          path(d='M18.3 5.7a1 1 0 0 1 0 1.4L13.4 12l4.9 4.9a1 1 0 1 1-1.4 1.4L12 13.4l-4.9 4.9a1 1 0 0 1-1.4-1.4l4.9-4.9-4.9-4.9A1 1 0 1 1 7.1 4.3L12 9.2l4.9-4.9a1 1 0 0 1 1.4 0Z' fill='currentColor')
        span.sr-only Cerrar
      .lightbox__inner.nav-overlay__inner
        .nav-overlay__content
          form.nav-overlay__search-form(action='/search' method='GET' role='search' aria-label='Buscar')
            input.form-control.nav-overlay__search-input(type='search', name='q', placeholder='Buscar', aria-label='Buscar')
          ul.nav-overlay__list
            li
              a.nav-overlay__link(href='/artworks') Obras
            li
              a.nav-overlay__link(href='/artists') Artistas
            li
              a.nav-overlay__link(href='/exhibitions') Exposiciones
            if currentUser && currentUser.role === 'artist'
              li
                a.nav-overlay__link(href='/artists/panel' aria-label='Panel de artista') Panel de artista
            if currentUser
              li
                a.nav-overlay__link(href='/activity') Actividad
            if !currentUser
              li
                a.nav-overlay__link(href='/login' aria-label='Iniciar sesión') Iniciar sesión
              li
                a.nav-overlay__link(href='/signup' aria-label='Registrarse') Registrarse

  if currentUser
      #navUserOverlay.lightbox.nav-overlay(
        role='dialog'
        aria-modal='true'
        aria-label='MenA� de usuario')
        button.lightbox__close.nav-overlay__close(type='button' aria-label='Cerrar menA� de usuario')
          svg(viewBox='0 0 24 24' fill='none' aria-hidden='true')
            path(d='M18.3 5.7a1 1 0 0 1 0 1.4L13.4 12l4.9 4.9a1 1 0 1 1-1.4 1.4L12 13.4l-4.9 4.9a1 1 0 0 1-1.4-1.4l4.9-4.9-4.9-4.9A1 1 0 1 1 7.1 4.3L12 9.2l4.9-4.9a1 1 0 0 1 1.4 0Z' fill='currentColor')
          span.sr-only Cerrar
        .lightbox__inner.nav-overlay__inner
          .nav-overlay__content
            ul.nav-overlay__list
              li
                a.nav-overlay__link(href='/edit-profile' aria-label='Editar cuenta') Editar cuenta
              if currentUser && currentUser.role === 'artist'
                li
                  a.nav-overlay__link(href='/artists/panel' aria-label='Panel de artista') Panel de artista
              if currentUser && currentUser.role === 'admin'
                li
                  a.nav-overlay__link(href='/admin' aria-label='Panel de administrador') Panel de administrador
              li
                form(action='/api/v1/auth/logout' method='POST')
                  button.btn.btn-outline-danger.nav-user-logout-btn(type='submit' aria-label='Cerrar sesion') Cerrar sesion

  if !hideFooter
    include ./footer.pug

    //- JS al final del body (orden importante)
    script(src='/bootstrap/js/bootstrap.bundle.min.js')
    script(src='/js/masonry.pkgd.min.js')
    script(src='/js/imagesloaded.js')
    script(src='/js/classie.js')
    script(src='/js/AnimOnScroll.js')

    //- Permite que vistas inyecten JS (por ejemplo, inicializaciones específicas) ANTES de main.js
    block scriptsExtra
    
    script(src='/js/masonry-init.js?v=2')

    //- Tu JS global
    script(src='/js/main.js')
    //- Lógica de overlay y compartir movida a /js/main.js
    //- Región aria-live para confirmaciones accesibles
    #sr-live.visually-hidden(aria-live='polite' aria-atomic='true')

    //- Nota: sin inyecciones — la vista de artista controla su propio botón Compartir



